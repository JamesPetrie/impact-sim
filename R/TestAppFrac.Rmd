---
title: "R Notebook"
output: html_notebook
---


Start with percent population app users, then incorporate heterogeneity
fracApp = 0.2
fracContactsWithApp = 0.8 (fracApp - homogenous, 1.0 - separated)
P(app user infects other | app user infects someone) = 1 - fracContactsWithApp
P(other infects app user | other infects someone) = (1 - fracContactsWithApp)*fracApp/(1-fracApp)

Make rate matrix. Group 1 app, group 2 no app 

flow =  [fracContactsWithApp ,                          1 - fracContactsWithApp;
(1 - fracContactsWithApp)*fracApp/(1-fracApp), 1 - (1 - fracContactsWithApp)*fracApp/(1-fracApp)
]

trace = [0.9 , 0.5;
        0.5,  0.5]


```{r}
#library(ringbp)
library(ggplot2)
library(data.table)

cap_cases = 50000


fracApp = 0.8
mixing = 1.0
#fracContactsWithApp = 0.8 #(fracApp - homogenous, 1.0 - separated)

# percent of interaction a person in group i has with group j = flow[i,j]
#flow = rbind(c(fracContactsWithApp , 1 - fracContactsWithApp), 
#             c((1 - fracContactsWithApp)*fracApp/(1-fracApp), 1 - (1 - fracContactsWithApp)*fracApp/(1-fracApp)))

#appAcc = 0.9
#genAcc = 0.5
#traceAcc = rbind(c(appAcc, genAcc), c(genAcc,genAcc)) # probability of tracing transmission from person in group i to person in group j = trace[i,j]

res <- scenario_sim(n.sim = 10,
num.initial.cases = 10,
cap_max_days = 45,
cap_cases = cap_cases,
r0isolated = 0.0,
r0community = 2.5,
disp.iso = 1,
disp.com = 0.16,
k = 0.7,
delay_shape = 1.651524,
delay_scale = 4.287786,
prop.asym = 0,
prop.ascertain = 0.8,
quarantine = TRUE,
fracApp = fracApp,
mixing = mixing)
  
  
                    # n.sim = 8, num.initial.cases = 30,prop.asym=0,
                    #  prop.ascertain = 0.01, cap_cases = 4500, cap_max_days = 60,
                    #  r0isolated = 0.0, r0community = 2.5, disp.com = 0.16, disp.iso = 1, delay_shape = 1.651524,
                    #  delay_scale = 4.287786,k = 0, quarantine = FALSE)

# Plot of weekly cases
ggplot2::ggplot(data=res, ggplot2::aes(x=week, y=weekly_cases, col = as.factor(sim))) +
  ggplot2::geom_line(show.legend = FALSE, alpha=0.7) +
  ggplot2::scale_y_continuous()

ringbp::extinct_prob(res,cap_cases = cap_cases)
res[,max(cumulative), by = sim]
```

