---
title: "R Notebook"
output: html_notebook
---



```{r}
library(ringbp)
library(ggplot2)
library(data.table)
library(plyr)

cap_cases = 50000


n.sim = 20

fracApp = c(0.01,0.1, 0.2,0.3, 0.4,0.5, 0.6,0.7, 0.8, 0.9, 0.99) # fraction of the population using the app
mixing = seq(0.0,1.0, length.out = 5) # how well mixed the app group is with the non-app group (0 = separate, 1 = homegenous)


appAcc = 0.9 # contact tracing accuracy if both people have app
genAcc = 0.5 # contact tracing accuracy if at least one doesn't have app

params = data.table(expand.grid(fracApp = fracApp, mixing = mixing))

sweepRes = mdply(params, function(fracApp, mixing){
  res <- scenario_sim(n.sim = n.sim,
num.initial.cases = 10,
cap_max_days = 45,
cap_cases = cap_cases,
r0isolated = 0.0,
r0community = 2.5,
disp.iso = 1,
disp.com = 0.16,
k = 0.7,
delay_shape = 1.651524,
delay_scale = 4.287786,
prop.asym = 0,
prop.ascertain = 0.8,
quarantine = TRUE,
fracApp = fracApp,
mixing = mixing,
appAcc = appAcc,
genAcc = genAcc)
  res[,fracApp := fracApp]
  res[, mixing:=mixing]
})

  
  
plotDt = sweepRes[, list(meanAppInfected = sum(frac1*weekly_cases/fracApp/n.sim , na.rm = TRUE)), by=list(fracApp, mixing)]

# Some of the curves when the population is completely mixed
ggplot(sweepRes[mixing == 0.5], aes(x = week, y = weekly_cases*frac1/fracApp, colour = as.factor(fracApp), style = mixing, group = paste(fracApp, mixing, sim))) + geom_line(alpha = 0.22,  show.legend = TRUE)


# relative risk to an app user as a function of how many app users there are and how mixed they are with non app users
ggplot(plotDt, aes(x = fracApp, y = mixing, z = (meanAppInfected))) + stat_summary_2d(bins = c(10,5))
```

